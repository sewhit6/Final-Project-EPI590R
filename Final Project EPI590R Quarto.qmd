---
title: "EPI590R Final Project"
author: "Sarah Whiteside"
execute: 
  echo: false
format: html
---
## EPI 590R Final Project

## Central Park Squirrels Analysis

**Installation of packages**
This step installs packages that are not already installed on your computer neccessary for the following code to work. 
```{r}
#| messages: false
#| echo: false
#| results: hide
packages_to_install <- c("tidytuesdayR", "gtsummary", "tidyverse", "here", "readr")
#install.packages(packages_to_install)
lapply(packages_to_install, require, character.only=TRUE)
```

## Reading in the dataset
```{r here} 
#| message: false
#| echo: false
#| results: hide
here::here()
# my project directory is "/Users/swhiteside/Final Project EPI590R"
getwd()
# my working directory is "/Users/swhiteside/Final Project EPI590R"
squirrel_data <- read_csv(here("squirrel_data.csv"))
```

# *Central Park Squirrel Census*

## Squirrel data! The data this week comes from the 2018 Central Park Squirrel Census.

**Data Descriptions:** The Squirrel Census is a multimedia science, design, and storytelling project focusing on the Eastern gray (Sciurus carolinensis). They count squirrels and present their findings to the public. The dataset contains squirrel data for each of the 3,023 sightings, including location coordinates, age, primary and secondary fur color, elevation, activities, communications, and interactions between squirrels and with humans.

**Cleaning the dataset**
```{r cleaning}
squirrel_data$Age[squirrel_data$Age == "?"] <- NA
```
This step is neccessary as some of the missing values for Age were coded as NA and others as question marsk (?). This homogenizes the missing values as NA. 

**Table 1. Descriptive Statistic**
```{r}
#| label: descriptive-table
#| tbl-cap: "Table 1. Descriptive Statistics" 
#| message: false

descriptive_table <- tbl_summary(
	squirrel_data,
	by = "Primary Fur Color",
	include = c("Age", "Shift", "Running", "Chasing", "Climbing", "Foraging"),
	missing_text = "Missing") |> 
		add_p(test = list (all_continuous() ~ "t.test",
											 all_categorical() ~ "chisq.test")) |> 
		add_overall(last=TRUE) |> 
		bold_labels() |> 
		modify_footnote(update = everything() ~ NA) |> 
		modify_header(label = "**Variable**", p.value = "**P**") |> 
    modify_caption(caption = "Table 1. Descriptive Statistics")
descriptive_table 


inline_text(descriptive_table, variable="Age", column = "Black", level = "Juvenile") #8 (8%)
inline_text(descriptive_table, variable="Age", column = "Gray", level = "Juvenile") #256 (11%)
inline_text(descriptive_table, variable="Age", column = "Cinnamon", level = "Juvenile") # 58 (15%)
inline_text(descriptive_table, variable="Age", column = "Black", level = "Adult") #92 (92%)
inline_text(descriptive_table, variable="Age", column = "Gray", level = "Adult") #2125 (89%)
inline_text(descriptive_table, variable="Age", column = "Cinnamon", level = "Adult") #326 (85%)
```


@descriptive-table describes the distribution of certain characteristics of the squirrels in Central Park. One of these characteristics is Age, which is displayed by primary fur color.  

For the juvenile age category, there were `r inline_text(descriptive_table, variable = "Age", column = "Black", level = "Juvenile")` Black juvenile squirrels and `r inline_text(descriptive_table, variable = "Age", column = "Black", level = "Adult")` adult Black squirrels.  

There were `r inline_text(descriptive_table, variable = "Age", column = "Gray", level = "Juvenile")` juvenile Gray squirrels and `r inline_text(descriptive_table, variable = "Age", column = "Gray", level = "Adult")` adult Gray squirrels.  

Lastly, there were `r inline_text(descriptive_table, variable = "Age", column = "Cinnamon", level = "Juvenile")` juvenile Cinnamon squirrels and `r inline_text(descriptive_table, variable = "Age", column = "Cinnamon", level = "Adult")` adult Cinnamon squirrels.

**Table 2. Regression Table**
```{r} 
#| label: regression-table
#| tbl-cap: "Table 2. Binomial Logistic Regression" 

# Recode binary (TRUE/FALSE) predictors with a function
binary_func <- function(data, cols) {
  squirrel_data[cols] <- lapply(squirrel_data[cols], function(x) ifelse(x, 1, 0))
  squirrel_data}

# Using the binary function
squirrel_data <- squirrel_data |> binary_func(c("Tail flags", "Tail twitches"))

# Recode outcome as factor (Adult = 1, Juvenile = 0)
squirrel_data$Age <- factor(
  ifelse(squirrel_data$Age == "Adult", 1,
  ifelse(squirrel_data$Age == "Juvenile", 0, NA)),
  levels = c(0, 1),
  labels = c("Juvenile", "Adult"))

# Run regression
table2 <- tbl_uvregression(
  data = squirrel_data,
  y = Age,
  include = c("Tail flags", "Tail twitches"),
  method = glm,
  method.args = list(family = binomial()),
  exponentiate = TRUE) |> 
	modify_header(label ~ "**Predictors**") |>
	modify_caption("**Table 2. Binomial Logistic Regression - Tail Flags and Twitches as Predictors of Squirrel Age**")
table2
```

@regression-table is a binomial logistic regression that has age as the predictor and tail flags and tail twitches as outcomes.
